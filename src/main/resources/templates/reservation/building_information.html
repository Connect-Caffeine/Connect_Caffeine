	<!DOCTYPE html>
	<html xmlns:th="http://www.thymeleaf.org"
	     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	     layout:decorate="~{include/layout}">
	<head>
	  <meta charset="utf-8">
	  <meta content="width=device-width, initial-scale=1.0" name="viewport">
	  <title>Connect Caffeine</title>
	  <meta content="" name="description">
	  <meta content="" name="keywords">
	  <!-- Favicons -->
	  <link href="/bootstrap/img/쿼카.png" rel="icon">
	  <link href="/bootstrap/img/쿼카.png" rel="쿼카">
	  <!-- Google Fonts -->
	  <link href="https://fonts.gstatic.com" rel="preconnect">
	  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i%7CNunito:300,300i,400,400i,600,600i,700,700i%7CPoppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
	  <!-- Vendor CSS Files -->
	  <link href="/bootstrap/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	  <link href="/bootstrap/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
	  <link href="/bootstrap/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
	  <link href="/bootstrap/vendor/quill/quill.snow.css" rel="stylesheet">
	  <link href="/bootstrap/vendor/quill/quill.bubble.css" rel="stylesheet">
	  <link href="/bootstrap/vendor/remixicon/remixicon.css" rel="stylesheet">
	  <link href="/bootstrap/vendor/simple-datatables/style.css" rel="stylesheet">
	  <!-- Template Main CSS File -->
	  <link href="/bootstrap/css/style.css" rel="stylesheet">
	  <link href="/bootstrap/css/nav_sider.css" rel="stylesheet">
	  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<style>
	.information{
	    margin-left: 350px; /* 메인 콘텐츠와 동일하게 설정하여 일관성 유지 */
    	padding: 40px;
	}
	      /* 건물 및 회의실 탭 버튼 */
      .information {
          padding: 20px 0;
      }
	      .tab-button {
          display: inline-block;
          padding: 10px 20px;
          margin: 0 10px 20px 0; /* 좌우 및 아래 여백 설정 */
          border: none;
          background-color: #6c757d;
          color: white;
          cursor: pointer;
          border-radius: 5px;
      }
	      .tab-button.active {
          background-color: #007bff; /* 활성화된 버튼 색상 */
      }
	      /* 버튼 스타일 */
      .btn {
          padding: 10px 20px;
          margin: 5px;
      }
	     /* 검은색 구분선 */
      hr {
          border: 0;
          height: 1px;
          background: black;
          margin: 20px 0;
      }
	</style>
	</head>
	<body>
	 <th:block layout:fragment="content">
	  <main id="main" class="main">
	    <div class="pagetitle">
	      <h1>건물 등록</h1>
	      <aside id="apprSidebar" class="apprSidebar">
	     <div class="reservation-box">
	        <div class="reservation-header">
	            <h3>예약 목록</h3>
	            </div> 
	          <div th:each="building : ${buildings}">
	          	<h2 th:text="${building.building_name}">Building Name</h2>
	          	   <div class="building-name">
	  			   	<button th:onclick="|location.href='@{/building_information/{buildingNo}(buildingNo=${building.building_no})}'|">
	      		   <i class="bi bi-gear"></i>
	  			   </button> 
				</div>
	          	<ul>
					<li th:each="meeting : ${meetings}" th:if="${meeting.building_no == building.building_no}">
	            		<a href="#"><span th:text="${meeting.meeting_name}"></span></a>
	        		</li>
	            </ul>
				</div>
	        <a th:href="@{/Building}"><button class="building-register-btn">+ 건물 등록</button></a>
	    </div>
	    </aside>
	    </div>
			<div class="information">
			  <button class="tab-button active" th:data-building-no="${dto.building_no}" onclick="showBuildingTab(this)">건물</button>
   			  <button class="tab-button" th:data-building-no="${dto.building_no}" onclick="showMeetingTab(this)">회의실</button>
			<hr>
			</div>
	    <div class="register_board_form" >
	        <form id="buildingUpdateFrm" method="post">
	            <input type="hidden" name="_csrf" th:value="${_csrf.token}"/>
	            <input type="hidden" name="building_no" id="building_no" th:value="${dto.building_no}"/> <!-- 건물 번호 -->
	            <p>이름: <input type="text" name="building_name" id="building_name" th:value="${dto.building_name}"></p>
	            <p>주소: <input type="text" name="building_postcode" id="building_postcode" th:value="${dto.building_postcode}"></p>
	            <p><input type="text" name="building_address" id="building_address" th:value="${dto.building_address}"></p>
	            <p><input type="text" name="building_addr_detail" id="building_addr_detail" th:value="${dto.building_addr_detail}"></p>
	           <div>
	               <button type="submit" class="btn btn-primary">수정</button>
	               <button type="button" class="btn btn-danger" onclick="deleteBuilding()">삭제</button>
	           </div>
	        </form>
	        <br><button onclick="execDaumPostcode()">주소 검색</button>
	    </div>
	<script>
	// 회의실 정보를 보려고 들어가는 기능
	function showMeetingTab(button){
		const buildingNo = button.getAttribute('data-building-no');
		const parsedBuildingNo = paseInt(buildingNo);
		if(isNaN(paredBuidlingNo)){
			return;
		}
		window.location.href=`/building_meetingroom/@{pasedBuildingNo}`;
	}
	
	//빌딩 버튼을 눌렀을때 다시 들어가는 기능 회의실에서 빌딩 누르면 다시 보이게(새로고침?).
	function showBuildingTab(button) {
	    const buildingNo = button.getAttribute('data-building-no');
	    const parsedBuildingNo = parseInt(buildingNo);
	    if (isNaN(parsedBuildingNo)) {
	        return;
	    }
	    window.location.href = `/building_information/${parsedBuildingNo}`;
	}

	
	
	
	
	
	
	//HTML에서 CSRF 토큰 값을 가져옴
	const csrfToken = document.querySelector('input[name="_csrf"]').value;
	
	const form = document.getElementById("buildingUpdateFrm");
	form.addEventListener('submit', (e) => {
	    e.preventDefault();
	    let vali_check = false;
	    let vali_text = "";
	
	    if (form.building_name.value == "") {
	        vali_text += "이름을 입력하세요.";
	        form.building_name.focus();
	    } else if (form.building_postcode.value == '') {
	        vali_text += "우편번호를 입력하세요";
	        form.building_postcode.focus();
	    } else if (form.building_address.value == '') {
	        vali_text += "주소를 입력하세요";
	        form.building_address.focus();
	    } else if (form.building_addr_detail.value == '') {
	        vali_text += "상세 주소를 입력하세요";
	        form.building_addr_detail.focus();
	    } else {
	        vali_check = true;
	    }
	
	    if (!vali_check) {
	        alert(vali_text);
	    } else {
	        const payload = new FormData(form);
	        
	        // CSRF 토큰 추가
	        payload.append("_csrf", csrfToken);
	
	        fetch('/buildingUpdate', {
	            method: 'POST',
	            body: payload,
	            headers: {
	                "X-CSRF-TOKEN": csrfToken  // CSRF 토큰을 헤더에도 추가
	            }
	        })
	        .then(response => response.json())
	        .then(data => {
	            if (data.res_code === '200') {
	                Swal.fire({
	                    icon: 'success',
	                    title: '수정되었습니다',
	                    text: data.res_msg,
	                    confirmButtonText: "닫기"
	                }).then((result) => {
	                	 const buildingNo = document.getElementById("building_no").value;
	                	location.href = "/building_information/"+buildingNo;
	                });
	            } else {
	                Swal.fire({
	                    icon: 'error',
	                    title: '수정되지 않았습니다.',
	                    text: data.res_msg,
	                    confirmButtonText: "닫기"
	                });
	            }
	        });
	    }
	});
	
	function deleteBuilding() {
	    const buildingNo = document.getElementById("building_no").value;

	    // 삭제 확인 메시지 표시
	    Swal.fire({
	        title: '정말 삭제하시겠습니까?',
	        text: "삭제하면 복구할 수 없습니다!",
	        icon: 'warning',
	        showCancelButton: true,
	        confirmButtonColor: '#3085d6',
	        cancelButtonColor: '#d33',
	        confirmButtonText: '삭제',
	        cancelButtonText: '취소'
	    }).then((result) => {
	        if (result.isConfirmed) {
	            // 삭제 요청 전송
	            fetch(`/building_delete/${buildingNo}`, {
	                method: 'POST',
	                headers: {
	                    "X-CSRF-TOKEN": csrfToken  // CSRF 토큰을 헤더에 추가
	                }
	            })
	            .then(response => response.json())
	            .then(data => {
	                if (data.res_code === '200') {
	                    Swal.fire(
	                        '삭제되었습니다!',
	                        '해당 건물이 삭제되었습니다.',
	                        'success'
	                    ).then(() => {
	                        location.href = "/Building"; // 삭제 후 이동할 페이지 설정
	                    });
	                } else {
	                    Swal.fire({
	                        icon: 'error',
	                        title: '삭제되지 않았습니다.',
	                        text: data.res_msg,
	                        confirmButtonText: "닫기"
	                    });
	                }
	            });
	        }
	    });
	}
	
		
		function execDaumPostcode() {
			new daum.Postcode({
				oncomplete: function(data) {
					// 팝업에서 검색결과 선택시 입력값 세팅
					document.getElementById('building_postcode').value = data.zonecode; // 우편번호
					document.getElementById('building_address').value = data.address; // 기본 주소
					document.getElementById('building_addr_detail').focus();
				}
				}).open();
		}
	</script>
	</main>
	</th:block>
	</body>
	</html>