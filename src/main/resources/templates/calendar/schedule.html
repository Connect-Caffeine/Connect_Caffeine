<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
     layout:decorate="~{include/layout}">
  <head>
    <meta charset='utf-8' />
  	<meta content="width=device-width, initial-scale=1.0" name="viewport">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>

  <title>Connect Caffeine</title>
  <meta content="" name="description">
  <meta content="" name="keywords">
  <!-- Favicons -->
  <link href="/bootstrap/img/쿼카.png" rel="icon">
  <link href="/bootstrap/img/쿼카.png" rel="쿼카">
  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i%7CNunito:300,300i,400,400i,600,600i,700,700i%7CPoppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  <!-- Vendor CSS Files -->
  <link href="/bootstrap/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/bootstrap/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/bootstrap/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="/bootstrap/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="/bootstrap/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="/bootstrap/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="/bootstrap/vendor/simple-datatables/style.css" rel="stylesheet">
  <!-- Template Main CSS File -->
  <link href="/bootstrap/css/style.css" rel="stylesheet">
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  </head>
  
  <body>
 
  <th:block layout:fragment="content">
	   <main id="main" class="main">
		   <div class="sub-sidebar" id="sub-sidebar">
		    	<span class="subside_title">캘린더</span><br><br>
			      <!-- Vertically centered Modal -->
	              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#verticalycentered" style="margin-left:50px">
	               일정 등록
	              </button>
	              <div class="modal fade" id="verticalycentered" tabindex="-1">
	                <div class="modal-dialog modal-dialog-centered modal-lg">
	                  <div class="modal-content">
	                    <div class="modal-header">
	                      <h5 class="modal-title">일정 등록</h5>
	                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                    </div>
	                    <div class="modal-body"><br>
	                     <!-- Floating Labels Form -->
			              <form id="scheduleForm" class="row g-3">
			              	<input type="hidden" id="csrf_token" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
			              	<input type="hidden" id="calendar_writer_no" name="calendar_writer_no" th:value="${#authentication.principal.dto.emp_code}">
			              	<div class="row mb-3">
			                  <label class="col-sm-2 col-form-label">일정 종류</label>
			                  <div class="col-sm-10">
			                    <select class="form-select" aria-label="Default select example" id="schedule_type" name="schedule_type">
			                      <option selected>선택하기</option>
			                      <option value="1">내일정</option>
			                      <option value="2">전사일정</option>
			                      <option value="3">부서일정</option>
			                      <option value="4">팀일정</option>
			                    </select>
			                  </div>
			                </div>
			                <div class="row mb-3">
			                  <label for="inputText" class="col-sm-2 col-form-label">제목</label>
			                  <div class="col-sm-10">
			                    <input type="text" class="form-control" id="schedule_title" name="schedule_title">
			                  </div>
			                </div>
			
				            <div class="row mb-3">
			                  <label for="inputPassword" class="col-sm-2 col-form-label">내용</label>
			                  <div class="col-sm-10">
			                    <textarea class="form-control" id="schedule_content" name="schedule_content" style="height: 100px"></textarea>
			                  </div>
			                </div>
			        		<div class="row mb-3">
			                  <label for="inputText" class="col-sm-2 col-form-label">장소</label>
			                  <div class="col-sm-10">
			                    <input type="text" class="form-control" id="location" name="location">
			                  </div>
			                </div>
			                <div class="row mb-3">
		                      <label class="col-sm-2 col-form-label">시작 시간</label>
		                      <div class="col-sm-10">
		                        <input type="datetime-local" class="form-control" id="start_time" name="start_time">
		                      </div>
		                    </div>
		                    <div class="row mb-3">
		                      <label class="col-sm-2 col-form-label">종료 시간</label>
		                      <div class="col-sm-10">
		                        <input type="datetime-local" class="form-control" id="end_time" name="end_time">
		                      </div>
		                    </div>

			              </form><!-- End floating Labels Form -->      
	                    </div>
	                    <div class="modal-footer">
	                      <button type="button" class="btn btn-primary" id="submitEvent">등록</button>
	                    </div>
	                  </div>
	                </div>
	              </div><!-- End Vertically centered Modal--><br><br>
			  <div class="schedule-filters">
				  <label>
				    <input type="checkbox" id="my-schedule" data-color="#f6c23e" checked>
				    내 일정(기본)
				  </label>
				  <input type= color>
				</div>
			</div>
	    	<div id='calendar' >
	    	</div>
	    </main>
	  
	 <script>
      document.addEventListener('DOMContentLoaded', function() {
       
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
          headerToolbar: {
            left: 'prevYear,prev,next,nextYear today',
            center: 'title',
            right: 'dayGridMonth,dayGridWeek,dayGridDay'
          },
          navLinks: true,
          editable: true,
          locale: 'ko',
          dayMaxEvents: true,
          events: [
        	  
          ] // 서버에서 가져온 데이터를 추가할 수 있음
        });

        calendar.render();

        document.getElementById('submitEvent').addEventListener('click', function() {
        	  var eventType = document.getElementById('schedule_type').value;
        	  var eventTitle = document.getElementById('schedule_title').value;
        	  var eventContent = document.getElementById('schedule_content').value;
        	  var eventLocation = document.getElementById('location').value;
        	  var startDate = document.getElementById('start_time').value;
        	  var endDate = document.getElementById('end_time').value;   
			  var empCode = document.getElementById('calendar_writer_no').value;
        	  // 서버로 전송할 일정 데이터
        	  var scheduleData = {
        	    schedule_type: eventType,
        	    schedule_title: eventTitle,
        	    schedule_content: eventContent,
        	    location: eventLocation,
        	    start_time: startDate,
        	    end_time: endDate,
        	    calendar_writer_no : empCode																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																			
        	  };

        	  // 일정 데이터를 서버로 POST 요청
        	  const csrfToken = document.getElementById('csrf_token').value;
        	  fetch('/calendar', {
        	    method: 'POST',
        	    headers: {
        	      'Content-Type': 'application/json;charset=utf-8',
        	      "Accept" : "application/json",
        	      'X-CSRF-TOKEN' : csrfToken
        	    },
        	    body: JSON.stringify(scheduleData)
        	  })
        	  .then(response => response.json())
        	  .then(data => {
        	    // 등록된 데이터를 캘린더에 반영
        	    calendar.addEvent({
        	      title: data.title,
        	      start: data.start,
        	      end: data.end
        	    });
        	    // 모달 닫기
        	    var modal = bootstrap.Modal.getInstance(document.getElementById('verticalycentered'));
        	    modal.hide();
        	  })
        	  .catch(error => {
        	    console.error('Error:', error);
        	  });
          });
      });
    </script>
	
  </th:block>

	   <!-- Vendor JS Files -->
	  <script src="/bootstrap/vendor/apexcharts/apexcharts.min.js"></script>
	  <script src="/bootstrap/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	  <script src="/bootstrap/vendor/chart.js/chart.umd.js"></script>
	  <script src="/bootstrap/vendor/echarts/echarts.min.js"></script>
	  <script src="/bootstrap/vendor/quill/quill.js"></script>
	  <script src="/bootstrap/vendor/simple-datatables/simple-datatables.js"></script>
	  <script src="/bootstrap/vendor/tinymce/tinymce.min.js"></script>
	  <script src="/bootstrap/vendor/php-email-form/validate.js"></script>
	  <!-- Template Main JS File -->
	  <script src="/bootstrap/js/main.js"></script>
  </body>
</html>